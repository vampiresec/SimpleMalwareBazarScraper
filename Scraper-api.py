#!/usr/bin/python
import os
import json
import pandas as pd

#Getting the tag from user
SearchMalwareFamily = str(input("Enter Malware Family: "))

#Note: it get all the malware samples infromation uploaded last 24 hours 
#By default the malware bazar api generates the json file 
#Saving json
os.system('wget --post-data "query=get_taginfo&tag=%s&limit=1000" https://mb-api.abuse.ch/api/v1/ -O Downloaded/json/%s.json'%(SearchMalwareFamily,SearchMalwareFamily))

#Converting the json to csv
file = open('Downloaded/json/%s.json'%SearchMalwareFamily)
data = json.load(file)
malwares = []

#Function Download Malware sampele with <sha256 hash>.zip
def DownloadSample(sha256):
    os.system('wget --post-data "query=get_file&sha256_hash=%s" https://mb-api.abuse.ch/api/v1/ -O Downloaded/samples/%s.zip'%(sha256,sha256))

for i in data['data']:
    malwares.append(i)
    #Uncomment the following line to Donwload Sample
    #DownloadSample(i['sha256_hash'])

#Saving dataframe in the form of csv
#Directory csv/
df = pd.DataFrame(malwares)
df.to_csv("csv/Malware-Bazar-%s-scraped-api.csv"%SearchMalwareFamily)

print("Success.....")

